# ğŸš€ å‰ç«¯éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²é¡¹ç›®çš„å‰ç«¯åº”ç”¨ã€‚

---

## ğŸ“‹ é¡¹ç›®ç»“æ„

æœ¬é¡¹ç›®åŒ…å«ä¸‰ä¸ªå‰ç«¯åº”ç”¨ï¼š

1. **ä¸»å‰ç«¯** (`frontend/`) - ä¸»åº”ç”¨å‰ç«¯
2. **åšå®¢å‰ç«¯** (`frontend/blog/`) - åšå®¢å‰ç«¯åº”ç”¨ï¼ˆç«¯å£ 3001ï¼‰
3. **ç®¡ç†åå°** (`frontend/admin/`) - ç®¡ç†åå°å‰ç«¯ï¼ˆç«¯å£ 3002ï¼‰

---

## ğŸ¯ éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šDocker å®¹å™¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•å’Œæ¨èçš„éƒ¨ç½²æ–¹å¼ï¼Œä½¿ç”¨ Docker å®¹å™¨åŒ–éƒ¨ç½²ã€‚

#### 1. ä½¿ç”¨ Docker Composeï¼ˆä¸€é”®éƒ¨ç½²æ‰€æœ‰æœåŠ¡ï¼‰

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /home/jeff/icey/open-source/inkspace

# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬å‰ç«¯ã€åç«¯ã€æ•°æ®åº“ï¼‰
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f frontend
```

**è¯´æ˜ï¼š**
- `docker-compose.yml` ä¼šè‡ªåŠ¨æ„å»ºå‰ç«¯ Docker é•œåƒ
- å‰ç«¯æœåŠ¡ä¼šè¿è¡Œåœ¨å®¹å™¨çš„ 80 ç«¯å£
- é€šè¿‡ `http://your-server-ip:80` è®¿é—®å‰ç«¯

#### 2. å•ç‹¬æ„å»ºå‰ç«¯ Docker é•œåƒ

##### æ„å»ºä¸»å‰ç«¯

```bash
cd /home/jeff/icey/open-source/inkspace/frontend

# æ„å»º Docker é•œåƒ
docker build -t mysite-frontend:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name mysite-frontend \
  -p 80:80 \
  --network mysite-network \
  mysite-frontend:latest
```

##### æ„å»ºåšå®¢å‰ç«¯

```bash
cd /home/jeff/icey/open-source/inkspace/frontend/blog

# æ„å»º Docker é•œåƒ
docker build -t mysite-blog-frontend:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name mysite-blog-frontend \
  -p 3001:80 \
  --network mysite-network \
  mysite-blog-frontend:latest
```

##### æ„å»ºç®¡ç†åå°å‰ç«¯

```bash
cd /home/jeff/icey/open-source/inkspace/frontend/admin

# æ„å»º Docker é•œåƒ
docker build -t mysite-admin-frontend:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name mysite-admin-frontend \
  -p 3002:80 \
  --network mysite-network \
  mysite-admin-frontend:latest
```

---

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨æ„å»ºéƒ¨ç½²

å¦‚æœä¸æƒ³ä½¿ç”¨ Dockerï¼Œå¯ä»¥æ‰‹åŠ¨æ„å»ºå¹¶éƒ¨ç½²ã€‚

#### æ­¥éª¤ 1ï¼šå®‰è£…ä¾èµ–

ç¡®ä¿æœåŠ¡å™¨å·²å®‰è£… Node.js 18+ å’Œ npmï¼š

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node -v  # åº”è¯¥ >= 18.0.0
npm -v

# å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œä½¿ç”¨ nvm å®‰è£…
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18
```

#### æ­¥éª¤ 2ï¼šæ„å»ºå‰ç«¯åº”ç”¨

##### æ„å»ºåšå®¢å‰ç«¯

```bash
cd /home/jeff/icey/open-source/inkspace/frontend/blog

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºå®Œæˆåï¼Œdist ç›®å½•åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶
ls -la dist/
```

##### æ„å»ºç®¡ç†åå°å‰ç«¯

```bash
cd /home/jeff/icey/open-source/inkspace/frontend/admin

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºå®Œæˆåï¼Œdist ç›®å½•åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶
ls -la dist/
```

#### æ­¥éª¤ 3ï¼šé…ç½® Nginx

åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å¹¶é…ç½® Nginxï¼š

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install nginx -y

# CentOS/RHEL
sudo yum install nginx -y
```

##### é…ç½®åšå®¢å‰ç«¯ Nginx

åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/blog-frontend`ï¼š

```nginx
server {
    listen 3001;
    server_name your-domain.com;
    root /home/jeff/icey/open-source/inkspace/frontend/blog/dist;
    index index.html;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;

    # Vue Router history æ¨¡å¼æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç† - ä»£ç†åˆ°åç«¯ API
    location /api {
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€æ–‡ä»¶ä»£ç†ï¼ˆä¸Šä¼ çš„å›¾ç‰‡ç­‰ï¼‰
    location /uploads {
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

##### é…ç½®ç®¡ç†åå° Nginx

åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/admin-frontend`ï¼š

```nginx
server {
    listen 3002;
    server_name admin.your-domain.com;
    root /home/jeff/icey/open-source/inkspace/frontend/admin/dist;
    index index.html;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;

    # Vue Router history æ¨¡å¼æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç† - ä»£ç†åˆ°ç®¡ç†åå° API
    location /api {
        proxy_pass http://localhost:8083;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€æ–‡ä»¶ä»£ç†
    location /uploads {
        proxy_pass http://localhost:8083;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

##### å¯ç”¨é…ç½®

```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/blog-frontend /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/admin-frontend /etc/nginx/sites-enabled/

# æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable nginx
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²æµç¨‹

å½“ä»£ç æ›´æ–°åï¼Œéœ€è¦é‡æ–°æ„å»ºå’Œéƒ¨ç½²ï¼š

### Docker æ–¹å¼æ›´æ–°

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/jeff/icey/open-source/inkspace

# åœæ­¢æ—§å®¹å™¨
docker-compose down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æˆ–è€…åªæ›´æ–°å‰ç«¯
docker-compose build frontend
docker-compose up -d frontend
```

### æ‰‹åŠ¨æ–¹å¼æ›´æ–°

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
cd /home/jeff/icey/open-source/inkspace
git pull

# 2. é‡æ–°æ„å»ºå‰ç«¯
cd frontend/blog
npm install  # å¦‚æœ package.json æœ‰æ›´æ–°
npm run build

cd ../admin
npm install
npm run build

# 3. é‡å¯ Nginxï¼ˆé€šå¸¸ä¸éœ€è¦ï¼Œä½†å»ºè®®ï¼‰
sudo systemctl reload nginx
```

---

## ğŸŒ åŸŸåå’Œ HTTPS é…ç½®

### ä½¿ç”¨åŸŸåè®¿é—®

ä¿®æ”¹ Nginx é…ç½®æ–‡ä»¶ä¸­çš„ `server_name`ï¼š

```nginx
server {
    listen 80;
    server_name blog.yourdomain.com;  # æ”¹ä¸ºä½ çš„åŸŸå
    # ... å…¶ä»–é…ç½®
}
```

### é…ç½® HTTPSï¼ˆä½¿ç”¨ Let's Encryptï¼‰

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# ä¸ºåšå®¢å‰ç«¯ç”³è¯·è¯ä¹¦
sudo certbot --nginx -d blog.yourdomain.com

# ä¸ºç®¡ç†åå°ç”³è¯·è¯ä¹¦
sudo certbot --nginx -d admin.yourdomain.com

# è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸ
```

---

## ğŸ“Š éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] Node.js 18+ å·²å®‰è£…ï¼ˆæ‰‹åŠ¨éƒ¨ç½²æ–¹å¼ï¼‰
- [ ] Docker å’Œ Docker Compose å·²å®‰è£…ï¼ˆDocker æ–¹å¼ï¼‰
- [ ] Nginx å·²å®‰è£…å¹¶é…ç½®ï¼ˆæ‰‹åŠ¨éƒ¨ç½²æ–¹å¼ï¼‰
- [ ] åç«¯ API æœåŠ¡å·²å¯åŠ¨ï¼ˆ8081 å’Œ 8083 ç«¯å£ï¼‰
- [ ] æ•°æ®åº“å·²é…ç½®å¹¶è¿è¡Œ
- [ ] é˜²ç«å¢™ç«¯å£å·²å¼€æ”¾ï¼ˆ80, 3001, 3002 ç­‰ï¼‰

### éƒ¨ç½²åéªŒè¯

- [ ] åšå®¢å‰ç«¯å¯ä»¥è®¿é—®ï¼š`http://your-server:3001`
- [ ] ç®¡ç†åå°å¯ä»¥è®¿é—®ï¼š`http://your-server:3002`
- [ ] API è¯·æ±‚æ­£å¸¸ï¼ˆæ£€æŸ¥æµè§ˆå™¨å¼€å‘è€…å·¥å…· Network æ ‡ç­¾ï¼‰
- [ ] é™æ€èµ„æºåŠ è½½æ­£å¸¸ï¼ˆå›¾ç‰‡ã€CSSã€JSï¼‰
- [ ] Vue Router è·¯ç”±è·³è½¬æ­£å¸¸
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ„å»ºå¤±è´¥

**ç—‡çŠ¶ï¼š** `npm run build` æŠ¥é”™

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ¸…ç† node_modules å’Œç¼“å­˜
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
npm run build
```

### é—®é¢˜ 2ï¼šAPI è¯·æ±‚ 404

**ç—‡çŠ¶ï¼š** å‰ç«¯å¯ä»¥è®¿é—®ï¼Œä½† API è¯·æ±‚è¿”å› 404

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ `proxy_pass` åœ°å€æ˜¯å¦æ­£ç¡®
- ç¡®è®¤åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆ`curl http://localhost:8081/api/works`ï¼‰
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†ç«¯å£è®¿é—®

### é—®é¢˜ 3ï¼šè·¯ç”±åˆ·æ–° 404

**ç—‡çŠ¶ï¼š** ç›´æ¥è®¿é—®è·¯ç”±åœ°å€ï¼ˆå¦‚ `/works/1`ï¼‰è¿”å› 404

**è§£å†³æ–¹æ¡ˆï¼š**
ç¡®ä¿ Nginx é…ç½®ä¸­æœ‰ä»¥ä¸‹è§„åˆ™ï¼š
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

### é—®é¢˜ 4ï¼šé™æ€èµ„æºåŠ è½½å¤±è´¥

**ç—‡çŠ¶ï¼š** å›¾ç‰‡ã€CSSã€JS æ–‡ä»¶æ— æ³•åŠ è½½

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥æ„å»ºåçš„ `dist` ç›®å½•æ˜¯å¦å­˜åœ¨
- æ£€æŸ¥ Nginx çš„ `root` é…ç½®è·¯å¾„æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š`chmod -R 755 dist/`

### é—®é¢˜ 5ï¼šDocker å®¹å™¨æ— æ³•è¿æ¥åç«¯

**ç—‡çŠ¶ï¼š** Docker å®¹å™¨ä¸­çš„å‰ç«¯æ— æ³•è®¿é—®åç«¯ API

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ Docker ç½‘ç»œï¼š`--network mysite-network`
- æ£€æŸ¥ `nginx.conf` ä¸­çš„ `proxy_pass` ä½¿ç”¨æœåŠ¡åè€Œé `localhost`ï¼š
  ```nginx
  proxy_pass http://backend:8081;  # ä¸æ˜¯ http://localhost:8081
  ```

---

## ğŸ“ ç¯å¢ƒå˜é‡é…ç½®

å¦‚æœéœ€è¦é…ç½®ä¸åŒçš„ API åœ°å€ï¼Œå¯ä»¥åœ¨æ„å»ºæ—¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# è®¾ç½® API åŸºç¡€åœ°å€
export VITE_API_BASE_URL=https://api.yourdomain.com

# æ„å»º
npm run build
```

æˆ–åœ¨ `vite.config.js` ä¸­é…ç½®ï¼š

```javascript
export default defineConfig({
  // ... å…¶ä»–é…ç½®
  define: {
    'import.meta.env.VITE_API_BASE_URL': JSON.stringify(process.env.VITE_API_BASE_URL || 'http://localhost:8081')
  }
})
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¯ç”¨ Gzip å‹ç¼©**ï¼ˆå·²åœ¨ nginx.conf ä¸­é…ç½®ï¼‰
2. **é™æ€èµ„æºç¼“å­˜**ï¼ˆå·²åœ¨ nginx.conf ä¸­é…ç½®ï¼‰
3. **ä½¿ç”¨ CDN** åŠ é€Ÿé™æ€èµ„æº
4. **å¯ç”¨ HTTP/2**
5. **å›¾ç‰‡æ‡’åŠ è½½**ï¼ˆå‰ç«¯ä»£ç ä¸­å·²å®ç°ï¼‰
6. **ä»£ç åˆ†å‰²**ï¼ˆVite è‡ªåŠ¨å¤„ç†ï¼‰

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š

1. `DEPLOYMENT.md` - å®Œæ•´éƒ¨ç½²æŒ‡å—
2. `FINAL-DEPLOYMENT-GUIDE.md` - æœ€ç»ˆéƒ¨ç½²æŒ‡å—
3. `README.md` - é¡¹ç›®è¯´æ˜æ–‡æ¡£

---

## âœ… æ€»ç»“

**æ¨èéƒ¨ç½²æ–¹å¼ï¼š** Docker Composeï¼ˆæœ€ç®€å•ã€æœ€å¯é ï¼‰

**éƒ¨ç½²æ­¥éª¤ï¼š**
1. ç¡®ä¿æœåŠ¡å™¨å·²å®‰è£… Docker å’Œ Docker Compose
2. å…‹éš†é¡¹ç›®ä»£ç 
3. è¿è¡Œ `docker-compose up -d --build`
4. è®¿é—® `http://your-server-ip:80` æŸ¥çœ‹å‰ç«¯

**æ›´æ–°æ­¥éª¤ï¼š**
1. `git pull` æ‹‰å–æœ€æ–°ä»£ç 
2. `docker-compose up -d --build` é‡æ–°æ„å»ºå¹¶å¯åŠ¨

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰

